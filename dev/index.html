<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · EEGToolkit.jl</title><meta name="title" content="Home · EEGToolkit.jl"/><meta property="og:title" content="Home · EEGToolkit.jl"/><meta property="twitter:title" content="Home · EEGToolkit.jl"/><meta name="description" content="Documentation for EEGToolkit.jl."/><meta property="og:description" content="Documentation for EEGToolkit.jl."/><meta property="twitter:description" content="Documentation for EEGToolkit.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href><img src="assets/logo.png" alt="EEGToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href>EEGToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Package-Features"><span>Package Features</span></a></li><li><a class="tocitem" href="#EEG"><span>EEG</span></a></li><li><a class="tocitem" href="#NREM-Period-detection"><span>NREM Period detection</span></a></li><li><a class="tocitem" href="#Spindle-detection"><span>Spindle detection</span></a></li><li><a class="tocitem" href="#Power-spectral-analysis"><span>Power spectral analysis</span></a></li><li><a class="tocitem" href="#Helpers"><span>Helpers</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/slopezpereyra/EEGToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="EEGToolkit.jl"><a class="docs-heading-anchor" href="#EEGToolkit.jl">EEGToolkit.jl</a><a id="EEGToolkit.jl-1"></a><a class="docs-heading-anchor-permalink" href="#EEGToolkit.jl" title="Permalink"></a></h1><p><em>Computational EEG analysis with emphasis in sleep neuroscience.</em></p><blockquote><p>Developed at the <a href="https://www.med.upenn.edu/slowwavelab/">Laboratory for the Study of Sleep Slow-wave activity</a></p></blockquote><blockquote><p>The Gods of the earth and sea  Sought thro&#39; Nature to find this Tree, But their search was all in vain: There grows one in the Human Brain.</p><p>William Blake</p></blockquote><p>This package has three aims in mind: </p><ul><li>Simplicity</li><li>Transparency</li><li>Efficiency</li></ul><p><em>Simplicity</em> means that a scientist with little programming background should be able to use it. <em>Transparency</em> means that any methodology implemented by the package should be transparent enough so as to be reported in a scientific paper.  <em>Efficiency</em> means that large EEGs (e.g. sleep EEGs) should be processed and analyzed in minutes or less.</p><p><em>Transparency</em> affects primarily spectral analysis. Most packages (e.g. the <code>gsignal</code> package in R) do not report how power spectrum analysis is done. Power spectral analysis is not standardized and may be computed in several many ways. This difficults comparing and testing results. This package reports the formula used for PSD estimation and incorporates features to extract such details from any <code>PSD</code> object.</p><p>Lastly, this </p><h2 id="Package-Features"><a class="docs-heading-anchor" href="#Package-Features">Package Features</a><a id="Package-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Package-Features" title="Permalink"></a></h2><ul><li>Loading and processing EEG data</li><li>EEG visualization</li><li>Sleep stage handling </li><li>NREM Period detection</li><li>Power spectral analysis</li><li>Spindle detection algorithms</li></ul><h2 id="EEG"><a class="docs-heading-anchor" href="#EEG">EEG</a><a id="EEG-1"></a><a class="docs-heading-anchor-permalink" href="#EEG" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.EEG" href="#EEGToolkit.EEG"><code>EEGToolkit.EEG</code></a> — <span class="docstring-category">Type</span></header><section><div><p>A mutable struct representing EEG data with associated metadata.</p><p><strong>Fields</strong></p><ul><li><code>signals::Dict{String, Vector{&lt;:AbstractFloat}}</code>: A dictionary mapping signal labels (strings) to arrays of floating-point values.</li><li><code>sampling_rates::Dict{String, Integer}</code>: A dictionary mapping signals (strings) to the integer sampling rates.</li><li><code>fs::Integer</code>: A default sampling rate that will be used for calculations. Defaults to the maximum sampling rate among all signals.</li><li><code>epoch_length::Integer</code>: Length of each epoch (in seconds).</li><li><code>staging::Vector{String}</code>: A vector of stage labels corresponding to each epoch.</li><li><code>id::String</code>: An identifier for the EEG.</li></ul><p><strong>Constructors</strong></p><p><code>EEG(file, fs, epoch_length, staging)</code>: Constructs an <code>EEG</code> object from an EDF file (<code>file</code>) containing EEG data. The function reads the signals, computes the necessary metadata (<code>fs</code>, <code>N</code>, <code>epoch_count</code>), and initializes the <code>EEG</code> struct with the provided <code>staging</code> vector.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">staging_vector = CSV.read(&quot;path/to/stage_data/eeg_staging.csv&quot;) # A vector with a stage per each epoch in the EEG
eeg_data = EEG(&quot;path/to/edf_data/data.edf&quot;, 30, staging_vector)

# Alternatively, if no stage data exists, it is safe to do 
eeg_data = EEG(&quot;path/to/edf_data/data.edf&quot;, 30, [])

# or simply 
eeg_data = EEG(&quot;path/to/edf_data/data.edf&quot;, 30) # Staging vector defaults to [] if not provided

# or simply
eeg_data = EEG(&quot;path/to/edf_data/data.edf&quot;) # Epoch length defaults to 30 if not provided.</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L5-L33">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.epoch" href="#EEGToolkit.epoch"><code>EEGToolkit.epoch</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>epoch(eeg::EEG, n::Integer, fs::Integer=-1)</code></p><p>Returns a vector [i₁, …, iₖ] with all indexes corresponding to the <code>n</code>th epoch of the EEG. The default sampling rate is used to compute the indexes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L61-L66">source</a></section><section><div><p><code>epoch(eeg::EEG, n::Integer, m::Integer, fs::Integer=-1)</code></p><p>Returns a vector [i₁, …, iₖ] with all indexes corresponding to epochs <code>n, n+1, …, m</code> of the EEG. The default sampling rate is used to compute the indexes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L72-L77">source</a></section><section><div><p><code>epoch(eeg::EEG, n::Integer, channel::String)</code></p><p>Returns a vector [x₁, …, xₖ] with all values of the signal <code>channel</code> in the <code>n</code>th epoch.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L89-L93">source</a></section><section><div><p><code>epoch(eeg::EEG, n::Integer, m::Integer, channel::String)</code></p><p>Returns a vector [x₁, …, xₖ] with all values of the signal <code>channel</code> in the epochs <code>n, n+1, …, m</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L100-L104">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.get_stage_indexes" href="#EEGToolkit.get_stage_indexes"><code>EEGToolkit.get_stage_indexes</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>get_stage_indexes(eeg::EEG, stages::Vector)</code></p><p>This function maps an EEG and a<code>stages</code> vector to the array of all indexes whose values in an EEG  signal pertain to a stage in <code>stages</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L171-L176">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.plot_eeg_overlay" href="#EEGToolkit.plot_eeg_overlay"><code>EEGToolkit.plot_eeg_overlay</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>plot_eeg_overlay(eeg::EEG, channels::Vector{String}, n::Integer, m::Integer)</code></p><p>Plots with the active backend all EEG channels in <code>channels</code> in the  range from the <code>n</code>th to the <code>m</code>th epoch.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L153-L158">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.gen_time_domain" href="#EEGToolkit.gen_time_domain"><code>EEGToolkit.gen_time_domain</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>gen_time_domain(eeg::EEG, s::Union{AbstractFloat,Integer}, e::Union{AbstractFloat,Integer}, fs::Integer=-1)</code></p><p>Given an EEG, generates the time vector t₁, …, tₙ corresponding to  EEG signals from time <code>s</code> to <code>e</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L111-L116">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.get_stage" href="#EEGToolkit.get_stage"><code>EEGToolkit.get_stage</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>function get_stage(eeg::EEG, channel::String, stages::Vector)</code></p><p>Returns all portions of an EEG channel in a given stage of the staging vector.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L191-L195">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.overlaps" href="#EEGToolkit.overlaps"><code>EEGToolkit.overlaps</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>overlaps(v::Vector{T}, L::Int, overlap_frac::Union{Float64,Int}) where {T}</code></p><p>Splits a vector <code>v</code> into segments of length <code>L</code> with an overlap <code>overlap_frac</code> expressed as a fraction of L. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L4-L8">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.plot_spectrogram" href="#EEGToolkit.plot_spectrogram"><code>EEGToolkit.plot_spectrogram</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>plot_spectrogram(spec::Spectrogram, freq_lim::AbstractFloat=30.0, type::Int=1, color=:nipy_spectral)</code></p><p>Plots a spectogram <code>spec</code> either in 2d (<code>type = 1</code>) or 3d (<code>type = 2</code>). An optional  frequency limit (<code>freq_lim</code>) may be set (defaults to 30Hz). The color palette  <code>color</code> may be set; defaults to <code>nipy_spectral</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L240-L246">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.freq_band" href="#EEGToolkit.freq_band"><code>EEGToolkit.freq_band</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>freq_band(spec::Union{PSD,AmplitudeSpectrum}, lower::AbstractFloat, upper::AbstractFloat)</code></p><p>Given a PSD, returns a Vector{AbstractFloat} with the powers within the frequency band [lower, upper].</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L294-L298">source</a></section><section><div><p><code>freq_band(spec::Spectrogram, lower::AbstractFloat, upper::AbstractFloat, window::Integer)</code></p><p>Given a spectrogram, returns a Vector{&lt;:AbstractFloat} with the powers within a frequency band [lower, upper] of a specific window (row of the spectrogram).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L305-L310">source</a></section><section><div><p><code>freq_band(spec::Spectrogram, lower::AbstractFloat, upper::AbstractFloat)</code></p><p>Given a spectrogram, returns a Matrix{&lt;:AbstractFloat} with the powers within a frequency band [lower, upper] across all windows.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L317-L322">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.plot_eeg" href="#EEGToolkit.plot_eeg"><code>EEGToolkit.plot_eeg</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Plots with the active backend all EEG channels in <code>channels</code> in the  range from the <code>n</code>th to the <code>m</code>th epoch.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L123-L126">source</a></section><section><div><p><code>plot_eeg(eeg::EEG, channels::Vector{String}, n::Integer, m::Integer)</code></p><p>Plots with the active backend all EEG channels in <code>channels</code> in the  range from the <code>n</code>th to the <code>m</code>th epoch.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L136-L141">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.artifact_reject" href="#EEGToolkit.artifact_reject"><code>EEGToolkit.artifact_reject</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>artifact_reject(eeg::EEG, anom_matrix::Matrix, signal::String)</code></p><p>Given an EEG, a 2x2 matrix associating epoch-subepoch pairs with artifacts, and a signal, returns a subset of the signal with all sub-epochs containing artifacts removed.</p><p>The signal is split in epoch-length windows and each window is split in subepoch-length  windows; the matrix gives the epoch and subepoch indexes to be removed. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/eeg.jl#L201-L209">source</a></section></article><h2 id="NREM-Period-detection"><a class="docs-heading-anchor" href="#NREM-Period-detection">NREM Period detection</a><a id="NREM-Period-detection-1"></a><a class="docs-heading-anchor-permalink" href="#NREM-Period-detection" title="Permalink"></a></h2><p>Following <a href="https://pubmed.ncbi.nlm.nih.gov/220659/">Feinberg &amp; Floyed</a> and Dijk, a NREM period is a sequence of epochs satisfying the following two conditions:</p><ul><li>It starts with stages 2, 3 or 4. </li><li>It contains at least 15 minutes of stages 2, 3 or 4 exist in total (not necessarily continuously).</li><li>It ends with either <span>$a.$</span> at least 5 minutes of REM or <span>$b.$</span> at least 5 minutes of wakefulness. </li></ul><p>The sequence is allowed to contain ocurrences of REM sleep or wakefulness, as long as their duration is inferior to 5 minutes. Naturally, the epochs corresponding to these occurrences will not be signaled as NREM.</p><p>Importantly, the restriction that ending REM periods must last at least 5 minutes is not imposed when detecting the first and the last NREM period in a night of sleep.</p><p>Let <span>$n$</span> be the number of epochs corresponding to <span>$15$</span> minutes and <span>$m$</span> the number of epochs corresponding to <span>$5$</span> minutes. (In 30 second epohcs, <span>$n = 30, m = 10$</span>). </p><p>For this algorithm to work, the <code>staging</code> field of an <code>EEG</code> object must have been set to a stage vector <span>$\vec{s}$</span>, and this vector must contain only the strings <span>$1, \ldots, 6, ?$</span> (with <span>$5$</span> marking REM, <span>$6$</span> wakefulness, <span>$?$</span> unknown/unstaged).</p><p>The algorithm works by mapping <span>$\vec{s}$</span> to <span>$\alpha = s_1 \ldots s_q$</span> a word over the language generated by <span>$\Sigma = \{1, \ldots, 6\}$</span>.</p><p>Observe that the language <span>$[(5+6)^*(2+3+4)^*]^*$</span> is partitioned into <span>$U$</span> and <span>$U’$</span>, where <span>$U$</span> is the set of words containing at least <span>$n$</span> symbols <span>$2, 3, 4$</span> where neither <span>$5$</span> nor <span>$6$</span> occur consecutively <span>$m = 10$</span> times. Then <span>$\alpha$</span> can be decomposed into </p><p class="math-container">\[\alpha = \psi_1 \phi_1 \psi_2 \phi_2 \ldots \psi_k \phi_k \psi_{k+1}\]</p><p>where <span>$\\phi_i = \\varphi_i (5^m5^* + 6^m6^*)$</span> and <span>$\\varphi_i \\in U$</span>. Such a decomposition readily provides the number of NREM periods in the EEG (i.e. <span>$k$</span>). Furthermore, the epochs which comprise these periods are easily inferable from the decomposition.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.nrem" href="#EEGToolkit.nrem"><code>EEGToolkit.nrem</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>nrem(staging::Vector, n::Integer=30, m::Integer=10)</code></p><p>Finds the <code>k</code> underlying NREM periods in a staging vector. Returns a vector of vectors <code>V</code> s.t. the <code>i</code>th vector in <code>V</code>  contains the epochs which comprise the <code>i</code>th NREM period. Thus, the length of <code>V</code> is <code>k</code> the number of NREM periods.</p><p>The <code>staging</code> field of the EEG must have been set to a vector  containing only the symbols <code>1, …, 6, ?</code> where <code>5</code> denotes  REM, <code>6</code> denotes wakefulness, and <code>?</code> denotes unscored/unstaged.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/nrem.jl#L47-L58">source</a></section><section><div><p><code>nrem(eeg::EEG, n::Integer=30, m::Integer=10)</code></p><p>Finds the <code>k</code> underlying NREM periods in the staging vector  of an EEG.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/nrem.jl#L110-L115">source</a></section></article><h2 id="Spindle-detection"><a class="docs-heading-anchor" href="#Spindle-detection">Spindle detection</a><a id="Spindle-detection-1"></a><a class="docs-heading-anchor-permalink" href="#Spindle-detection" title="Permalink"></a></h2><p>This package implements two spindle detection algorithms discussed in <a href="https://doi.org/10.3389/fnhum.2015.00353">O&#39;Reilly and Nielsen (2015)</a>. We give a brief overview of them here but refer to their original publications for further detail.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.sigma_index" href="#EEGToolkit.sigma_index"><code>EEGToolkit.sigma_index</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>function sigma_index(x::Vector{&lt;:AbstractFloat}, fs::Integer)</code></p><p>The <span>$\Sigma$</span>-index algorithm <a href="https://pubmed.ncbi.nlm.nih.gov/17555950/">(Huupponen et al., 2007)</a> find spindles by detecting abnormally high amplitudes values among the spindle frequency band. Per each 1 second window of the EEG,</p><ul><li>the maximum amplitude in the spindle frequency, which we call <span>$S_{max}$</span></li><li>the average amplitude in the low alpha and theta frequencies, which we call</li></ul><p><span>$\alpha_{mean}, \theta_{mean}$</span></p><ul><li>the maximum alpha amplitude <span>$\alpha_{max}$</span></li></ul><p>are all computed. The <span>$\Sigma$</span>-index is defined to be zero if <span>$\alpha_max &gt; S_{max}$</span>, and otherwise</p><p class="math-container">\[f(S_{max}, \alpha_{mean}, \phi_{mean}) = \frac{2S_{max}}{ \alpha_{mean} + \phi_{mean} } \]</p><p>Higher values are indicative of a higher spindle probability. The rejection threshold recommended in the original paper is <span>$\lambda = 4.5$</span>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/spindles.jl#L3-L25">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.relative_spindle_power" href="#EEGToolkit.relative_spindle_power"><code>EEGToolkit.relative_spindle_power</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>relative_spindle_power(x::Vector{&lt;:AbstractFloat}, fs::Integer)</code></p><p>The Relative Spindle Power (RSP) algorithm <a href="https://pubmed.ncbi.nlm.nih.gov/22254656/">(Devuyst et al., 2011)</a> also detects abnormal values along the spindle frequency band. For every 1 second window, the amplitude spectrum <span>$S(t)$</span> is computed, and the RSP is defined as</p><p class="math-container">\[RSP(t) = \frac{\int_{11}^{16} S(t, f) df}{\int_{0.5}^{40} S(t, f) df}\]</p><p>This definition is more intelligible than the that of the sigma index, insofar as it represents the ratio of the total power in the spindle band with respect to the total power in the <span>$\delta$</span> to <span>$\phi$</span> frequency range. It is evident by definition that <span>$0 \leq RSP \leq 1$</span>. Higher values are indicative of a higher spindle probability (it should be clear that <span>$RSP$</span> is not a probability itself). The rejection threshold recommended in the original paper is <span>$\lambda = 0.22$</span>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/spindles.jl#L54-L69">source</a></section></article><h2 id="Power-spectral-analysis"><a class="docs-heading-anchor" href="#Power-spectral-analysis">Power spectral analysis</a><a id="Power-spectral-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Power-spectral-analysis" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.AmplitudeSpectrum" href="#EEGToolkit.AmplitudeSpectrum"><code>EEGToolkit.AmplitudeSpectrum</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Structure for amplitude spectrum estimations. Estimations are by default  one sided, with frequencies ranging from [0, fₛ/2].</p><p>The formula used is </p><p class="math-container">\[\frac{2|H(f)|}{\sum_i w_i}\]</p><p>with <span>$w_i$</span> a Hanning window.</p><p><strong>Fields</strong></p><ul><li>freq::Vector{&lt;:AbstractFloat}: Frequency range of the spectrum</li><li>spectrum::Vector{&lt;:AbstractFloat}: Estimated spectral amplitude</li><li>formula::String: A string representation of the formula used for the estimation.</li></ul><p><strong>Constructors</strong></p><p><code>AmplitudeSpectrum(x::Vector{&lt;:AbstractFloat}, sampling_rate::Integer, pad::Integer)</code> : Computes a direct PSD over a signal <code>x</code> with a given <code>sampling_rate</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L41-L61">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.PSD" href="#EEGToolkit.PSD"><code>EEGToolkit.PSD</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Structure for PSD estimations. Estimations are by default  one sided, with frequencies ranging from [0, fₛ/2].</p><p>The default formula is </p><p class="math-container">\[\frac{2|H(f)|^2}{f_s \sum_i w_i^2}\]</p><p>with <span>$w_i$</span> a Hanning window. This means the estimation is normalized by  the sampling rate by default. This can be changed by setting the normalization  parameter equal to <span>$\frac{1}{f_s}$</span>, canceling out the factor in the denominator. </p><p>If Barlett or Welch&#39;s mehtod is used (i.e. if the second constructor is used), the formula  becomes </p><p class="math-container">\[\frac{1}{M \varphi} \sum_i^M \left[ \frac{2|H_i(f)|^2}{f_s \sum_i w_i^2} \right]\]</p><p>where <span>$w_1, \ldots, w_n$</span> a Hanning window, <span>$M$</span> the number of segments, <span>$H_i(f)$</span> the FFT of the <span>$i$</span>th segment of the signal, and <span>$\varphi$</span> an optional normalization factor defined by the <code>normalization</code> parameter (defaults to 1).</p><p><strong>Fields</strong></p><ul><li><code>freq::Vector{&lt;:AbstractFloat}</code>: Frequency range of the spectrum</li><li><code>spectrum::Vector{&lt;:AbstractFloat}</code> : Estimated spectral density in dB.</li><li><code>method::String</code>: Estimation method used </li><li><code>formula::String</code> : A string representation of the formula used for the estimation.</li></ul><p><strong>Constructors</strong></p><ul><li><code>PSD(x::Vector, sampling_rate::Integer, pad::Integer = 0)</code>: Computes a direct PSD over a signal <code>x</code> with a given <code>sampling_rate</code>.</li><li><code>PSD(x::Vector, fs::Int, L::Int, overlap::Union{ &lt;:AbstractFloat, Integer }, normalization::Union{ &lt;:AbstractFloat, Integer } = 1)</code>: Splits the signal <code>x</code> into segments of length L with an <code>overlap</code> in [0, 1). The overlap is understood to be a fraction of the segment length. PSD is estimated within and averaged across all segments. If <code>overlap</code> is zero, this results in Barlett&#39;s method. If <code>overlap</code> is greater than zero, this results in Welch&#39;s method. If <code>pad</code> is zero no zero-padding is done. If <code>pad</code> is greater than zero, each segment is zero-padded to a  length of <code>pad</code>. </li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L85-L118">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.Spectrogram" href="#EEGToolkit.Spectrogram"><code>EEGToolkit.Spectrogram</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Structure for spectrogram estimation. Estimations are by default one-sided, with frequencies ranging from [0, fₛ/2]. The signal is split into possibly overlapping  windows of length L; within each window, Welch&#39;s method is used to compute the  PSD with overlapping windows. For Barlett&#39;s method, one can set the inner window  length and the overlap to zero.</p><p><strong>Fields</strong></p><ul><li><code>time::Vector</code> : Time domain (x)</li><li><code>freq::Vector{&lt;:AbstractFloat}</code>: Frequency domain (y)</li><li><code>spectrums::Matrix{&lt;:AbstractFloat}</code>: Power spectrum (z). Rows are time and columns are frequency.</li><li><code>segment_length::Integer</code> : Length of each segment in time.</li></ul><p><strong>Constructors</strong></p><ul><li><code>Spectrogram(signal::Vector{&lt;:AbstractFloat}, fs::Integer, segment_length::Integer, overlap::AbstractFloat, inner_window_length::Integer, inner_overlap::AbstractFloat)</code> : Computes the <code>Spectrogram</code> of a <code>signal</code> with sampling rate <code>fs</code> in windows of length <code>segment_length</code> (in number of samples) with a certain <code>overlap</code> ∈ [0, 1].</li></ul><p>Within each window, the <code>PSD</code> constructor is used to compute either a Welch or  a Barlett method estimation, depending on the <code>inner_window_length</code> and  <code>inner_overlap</code> parameters. An optional normalization factor and a zero-padding  length can be included, as in the <code>PSD</code> constructor.</p><ul><li><code>Spectrogram(segs::Vector{Vector{&lt;:AbstractFloat}}, fs::Integer, segment_length::Integer, overlap::AbstractFloat, normalization::Union{AbstractFloat,Integer}=1, pad::Integer=0)</code>: This constructor does not take a signal but <em>a split or windowed signal</em>. This is useful, for example, when the EEG is split into windows corresponding to a specific period (e.g. NREM epochs). In this case, each time-instance in the Spectrogram corresponds to one of the windows. Aside from this, there is no difference with the previous constructor.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L176-L196">source</a></section></article><h2 id="Helpers"><a class="docs-heading-anchor" href="#Helpers">Helpers</a><a id="Helpers-1"></a><a class="docs-heading-anchor-permalink" href="#Helpers" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.next_power_of_two" href="#EEGToolkit.next_power_of_two"><code>EEGToolkit.next_power_of_two</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>next_power_of_two(n::Int)</code></p><p>Given an integer <code>n</code>, finds the least m = 2ᵏ s.t. m ≥ n.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L261-L265">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EEGToolkit.zero_pad" href="#EEGToolkit.zero_pad"><code>EEGToolkit.zero_pad</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>zero_pad(v::Vector{&lt;:AbstractFloat}, desired_length::Integer) where {T}</code></p><p>Zero-pads a numeric vector <code>v</code> to a <code>desired_length</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slopezpereyra/EEGToolkit.jl/blob/951ce6379126003c7c98a5e46d3b9155cd4ed240/src/psd.jl#L274-L278">source</a></section></article><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>This is an example script for computing the mean <span>$\delta$</span> (delta) power in each of the NREM periods of a sleep EEG. We will use the C3 channel.</p><pre><code class="language-julia hljs"># First, import the package
using EEGToolkit 
using CSV

# Assuming we have the stage data in a .csv
staging = CSV.read(&quot;my_staging_data.csv&quot;)

# We read an EEG that has channels C3-A2 and F3-A1
eeg = EEG(edf_file, staging.STAGES)

# Detect the NREM periods
nrems = nrem(eeg)

# Filter the EEG 
eeg.signals[&quot;C3-A2&quot;] = filt(digitalfilter(Lowpass(70, fs=eeg.fs), Butterworth(4)), eeg.signals[&quot;C3-A2&quot;] )
eeg.signals[&quot;C3-A2&quot;] = filt(digitalfilter(Highpass(0.3, fs=eeg.fs), Butterworth(4)), eeg.signals[&quot;C3-A2&quot;] )
eeg.signals[&quot;C3-A2&quot;] = filt(digitalfilter(Bandstop(50, 70, fs=eeg.fs), Butterworth(4)), eeg.signals[&quot;C3-A2&quot;] )

# Split the C3 signal into 30-second windows (not-overlapping).
epochs = overlaps(eeg.signals[&quot;C3-A2&quot;], eeg.fs * 30 * 30, 0)

mean_delta_powers = []
for nrem_period in nrems
    # Extract the portion of the signal corresponding to this NREM period
    nrem_epohcs = epochs[nrem_period]
    # Compute its spectrogram. (Observation: This is an example of when it&#39;s useful to be 
    # able to pass a vector argument to the Spectrogram constructor.)
    spec = Spectrogram(nrem_epochs, eeg.fs, eeg.fs*5 - 1, 0.5)

    # Extract delta band (0.5 to 3.9 Hz) from the spectrogram.
    delta_band = freq_band(spec, 0.5, 3.9)

    # Compute the mean power in this delta band
    mean_delta_power = mean(delta_band, dims=2) 
    push!(mean_delta_powers, mean_delta_power)
end

# Now the ith element in `mean_delta_powers` is the mean delta power 
of the ith NREM period.</code></pre></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Friday 31 May 2024 23:02">Friday 31 May 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
